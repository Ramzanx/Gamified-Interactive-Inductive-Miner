<h1 class="welcome-title">Welcome to the <a href="https://github.com/Ramzanx/Gamified-Interactive-Inductive-Miner"
    target="_blank" rel="noopener noreferrer">Gamified Interactive Inductive Miner!</a></h1>

<div class="stage-timer-container">
  <!-- Stage -->
  <div class="stage-indicator" [style.opacity]="gameRunning ? 1 : 0.5">
    Stage: {{ currentStage }}/{{ totalStages }}
  </div>

  <!-- Timer (centered)  -->
  <game-timer #gameTimer></game-timer>

  <!-- Spacer for layout symmetry -->
  <div class="stage-spacer"></div>
</div>

<div class="main-layout">
  <!-- Left: Canvas + difficulty screen -->
  <div id="resizableContainer" class="resizable-container">
    <difficulty-screen (difficultyChange)="onDifficultyChange($event)" [(stageCount)]="totalStages"
      [userLevel]="userLevel" (startGameAndTimer)="startGameTimer(); startGame(); gameRunning = true"
      (stopGameTimer)="stopGameTimer(); gameRunning = false" *ngIf="!gameRunning && !gameFinished">
    </difficulty-screen>

    <game-summary *ngIf="gameFinished" [totalStages]="totalStages" [totalTime]="totalTime" [stageTimes]="stageTimes"
      [stageScore]="stageScore" [totalScore]="totalScore" (expEarned)="onExpEarned($event)"
      (highscoreSubmitted)="addHighscore($event)" (playAgain)="onPlayAgain()"
      (toggleStageDetailsExpand)="onToggleStageDetails($event)" [selectedDifficulty]="selectedDifficulty">
    </game-summary>

    <svg #drawingArea id="drawing" class="canvas" (drop)="processDropEvent($event)"
      (mousedown)="processMouseDown($event)" (mouseup)="processMouseUp($event)" (mousemove)="processMouseMove($event)"
      (dragover)="prevent($event)" (contextmenu)="prevent($event)">
    </svg>
  </div>

  <!-- Right: Level Progress -->
  <div class="level-progress-wrapper">
    <level-progress [expEarned]="expEarned" (levelUp)="onLevelUp($event)"></level-progress>
    <player-info-panel [playerLevel]="userLevel" [hasCustomModeUnlocked]="customUnlocked" [winStreak]="currentStreak"
      [highscores]="highscores">
    </player-info-panel>
  </div>
</div>


<div class="settings-panel-wrapper">
  <!-- Buttons Row -->
  <div class="settings-button-row">

    <!-- Always visible buttons -->
    <button class="custom-button" [disabled]="isCommonButtonDisabled" (click)="resetCut()"
      (document:keydown.1)="resetCut()">
      Reset Marked Edges <br><i style="font-size: smaller;">Shortcut: 1</i> 
    </button>

    <button class="custom-button" [disabled]="isCommonButtonDisabled" (click)="applyFallThrough()"
      (document:keydown.2)="applyFallThrough()">
      Apply Fall Through <br><i style="font-size: smaller;">Shortcut: 2</i> 
    </button>

    <button class="custom-button" [disabled]="isCommonButtonDisabled" (click)="applyLayoutToSelectedEventLog()"
      (document:keydown.3)="applyLayoutToSelectedEventLog()">
      Redo DFG Layout <br><i style="font-size: smaller;">Shortcut: 3</i> 
    </button>

    <!-- Custom mode only -->
    <button *ngIf="selectedDifficulty === 'Custom'" class="custom-button" [disabled]="!isPetriNetFinished"
      (click)="performCut(true)">
      Perform Cut
    </button>

    <button *ngIf="selectedDifficulty === 'Custom'" class="custom-button" [disabled]="!isPetriNetFinished"
      (click)="downloadPetriNet('pnml')" title="Download PetriNet as PNML (enabled when finished)">
      Download PetriNet (PNML)
    </button>

    <button *ngIf="selectedDifficulty === 'Custom'" class="custom-button" [disabled]="!isPetriNetFinished"
      (click)="downloadPetriNet('json')" title="Download PetriNet as JSON (enabled when finished)">
      Download PetriNet (JSON)
    </button>
  </div>

  <!-- Toggles Row -->
  <div class="settings-toggle-row">

    <!-- Always visible toggle -->
    <label class="custom-toggle">
      <input type="checkbox" [(ngModel)]="isSpringEmbedder" (change)="applyLayout()"
        [disabled]="!isDFGinNet || isPetriNetFinished">
      <span class="slider"></span>
      Sugiyama/Spring Embedder
    </label>

    <!-- Custom mode only -->
    <label *ngIf="selectedDifficulty === 'Custom'" class="custom-toggle">
      <input type="checkbox" [(ngModel)]="colouredBoxesEnabled" (change)="toggleColouredBoxes()"
        [disabled]="!isDFGinNet ">
      <span class="slider"></span>
      Show Cut Outline Boxes
    </label>

  </div>
</div>